# Multi-Port Nacos Gateway Configuration

server:
  ports:
    apiV1: 18848                   # HTTP - Nacos V1 API
    apiV2: 19848                   # gRPC - Nacos V2 API
    apiConsole: 18080              # HTTP - Console API
  rateLimit:
    maxQps: 2000                   # Maximum requests per second (gateway level)
    maxConnections: 10000          # Maximum concurrent connections (gateway level)
    maxQpsPerClient: 10            # Maximum QPS per client
    maxConnectionsPerClient: 5     # Maximum connections per client

# Routes configuration
routes:
  - host: "localhost.dev"          # Request domain (supports wildcard *)
    backend: local-nacos           # Target backend service name
  - host: "localhost"              # Request domain (supports wildcard *)
    backend: local-nacos           # Target backend service name


# Backends configuration
backends:
  - name: local-nacos
    ports:
      apiV1: 8848                  # Backend Nacos V1 API port (HTTP)
      apiV2: 9848                  # Backend Nacos V2 API port (gRPC)
      apiConsole: 8080             # Backend Console port (HTTP)
    loadBalance: round-robin       # Load balancing strategy: round-robin/random/least-connection
    probe:
      enabled: true                # Enable health check
      type: http                   # Health check type: http/tcp
      path: /nacos/v1/cs/health    # Health check path (HTTP type only)
      periodSeconds: 10            # Check interval in seconds
      timeoutSeconds: 1            # Check timeout in seconds
      successThreshold: 1          # Success threshold
      failureThreshold: 3          # Failure threshold
    rateLimit:
      maxQps: 1000                 # Maximum QPS for this backend (optional)
      maxConnections: 2000         # Maximum connections for this backend (optional)
      maxQpsPerClient: 10          # Override server default for client QPS (optional)
      maxConnectionsPerClient: 5   # Override server default for client connections (optional)
    endpoints:
      - host: localhost            # Backend instance IP address
        priority: 10               # Endpoint priority (lower = higher priority)

# Timeout configuration
#timeout:
#  connectTimeoutSeconds: 10
#  requestTimeoutSeconds: 30
#  idleTimeoutSeconds: 60

# Access log configuration
accessLog:
  enabled: true                  # Set to true to enable access logging
  format: pattern                 # Log format: pattern or json
  pattern: "%h - - [%t] \"%m %U %H\" %s %b %D \"%{User-Agent}i\" \"%{Referer}i\"%n"
  output:
    path: logs/access.log
  rotation:
    policy: daily
    maxHistory: 30
  async:
    enabled: true

# Management endpoint configuration
management:
  health:
    enabled: true
    path: /health
